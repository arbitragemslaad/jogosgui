<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Controle de Jogos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f4f0;
      padding: 20px;
      margin: 0;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #2e7d32;
    }

    form {
      display: grid;
      gap: 10px;
      max-width: 500px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    input,
    select,
    button {
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    button {
      background-color: #2e7d32;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #27642b;
    }

    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }

    th,
    td {
      padding: 8px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }

    .valor-extra {
      max-width: 500px;
      margin: 10px auto;
      padding: 10px;
      background: #e0f2f1;
      border: 1px solid #b2dfdb;
      border-radius: 10px;
    }

    .ocultar {
      display: none;
    }

    @media (max-width: 600px) {

      form,
      .valor-extra,
      table {
        font-size: 14px;
      }

      th,
      td {
        padding: 6px;
      }
    }
  </style>
</head>

<body>

  <h1>Controle de Jogos</h1>

  <form id="form-jogo">
    <input type="date" id="data" required />
    <input type="text" id="local" placeholder="Local do jogo" required />
    <select id="funcao" required>
      <option value="">Selecione a função</option>
      <option value="Árbitro">Árbitro</option>
      <option value="Bandeirinha">Bandeirinha</option>
    </select>
    <input type="number" id="valor" placeholder="Valor total" required />
    <input type="number" id="quantidade" placeholder="Quantidade de jogos" value="1" required />
    <button type="submit">Adicionar</button>
  </form>

  <div class="valor-extra" id="valor-info" style="display: none;"></div>

  <table id="tabela-jogos">
    <thead>
      <tr>
        <th>Data</th>
        <th>Local</th>
        <th>Função</th>
        <th>Valor</th>
        <th>10%</th>
        <th>Líquido</th>
        <th>Qtd</th>
        <th>Excluir</th>
      </tr>
    </thead>
    <tbody id="lista-jogos"></tbody>
  </table>

  <button id="ver-todos" class="ocultar">Ver todos</button>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";

    // Sua configuração do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyC4cRV_g8XFCk2WHgLD0DBXkyf6Ttv_pm4",
      authDomain: "controle-de-jogos-f8ccd.firebaseapp.com",
      projectId: "controle-de-jogos-f8ccd",
      storageBucket: "controle-de-jogos-f8ccd.firebasestorage.app",
      messagingSenderId: "266691697880",
      appId: "1:266691697880:web:d1fa596bbd61e4f08e0bad"
    };

    // Inicializando o Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const form = document.getElementById("form-jogo");
    const lista = document.getElementById("lista-jogos");
    const verTodosBtn = document.getElementById("ver-todos");
    const valorInfo = document.getElementById("valor-info");

    let jogos = JSON.parse(localStorage.getItem("jogos") || "[]");

    // Função para salvar jogos no Firebase e localStorage
    async function salvarJogos() {
      try {
        for (let jogo of jogos) {
          // Adiciona os jogos no Firestore
          const docRef = await addDoc(collection(db, "jogos"), jogo);
          console.log("Jogo adicionado com ID: ", docRef.id);
        }

        // Atualiza o localStorage com os jogos
        localStorage.setItem("jogos", JSON.stringify(jogos));
      } catch (e) {
        console.error("Erro ao adicionar documento: ", e);
      }
    }

    // Função para carregar jogos do Firebase
    async function carregarJogosDoFirebase() {
      const querySnapshot = await getDocs(collection(db, "jogos"));
      querySnapshot.forEach((doc) => {
        const jogo = doc.data();
        jogo.id = doc.id;  // Atribui o ID do documento ao jogo
        jogos.push(jogo);
      });

      renderizarJogos();
    }

    // Inicializa os jogos com dados locais ou do Firebase
    function init() {
      // Carrega os jogos do localStorage, se existirem
      jogos = JSON.parse(localStorage.getItem("jogos") || "[]");

      // Carrega os jogos do Firebase
      carregarJogosDoFirebase();
    }

    // Chamando a função para iniciar o carregamento
    init();

    function calcularValores(valor) {
      const dezPorCento = valor * 0.1;
      const liquido = valor - dezPorCento;
      return { dezPorCento, liquido };
    }

    function renderizarJogos() {
      lista.innerHTML = "";
      const jogosExibidos = window.innerWidth < 600 ? jogos.slice(-3) : jogos;
      jogosExibidos.forEach((jogo, index) => {
        const tr = document.createElement("tr");
        const { dezPorCento, liquido } = calcularValores(jogo.valor);
        tr.innerHTML = `
          <td>${jogo.data}</td>
          <td>${jogo.local}</td>
          <td>${jogo.funcao}</td>
          <td>R$ ${jogo.valor.toFixed(2)}</td>
          <td>R$ ${dezPorCento.toFixed(2)}</td>
          <td>R$ ${liquido.toFixed(2)}</td>
          <td>${jogo.quantidade}</td>
          <td><button onclick="excluirJogo(${index}, '${jogo.id}')">X</button></td>
        `;
        lista.appendChild(tr);
      });

      if (jogos.length > 3 && window.innerWidth < 600) {
        verTodosBtn.classList.remove("ocultar");
      } else {
        verTodosBtn.classList.add("ocultar");
      }

      const total = jogos.reduce((soma, j) => soma + j.valor, 0);
      const { dezPorCento, liquido } = calcularValores(total);
      valorInfo.innerHTML = `
        <strong>Total:</strong> R$ ${total.toFixed(2)} |
        <strong>10%:</strong> R$ ${dezPorCento.toFixed(2)} |
        <strong>Líquido:</strong> R$ ${liquido.toFixed(2)}
      `;
      valorInfo.style.display = jogos.length ? "block" : "none";
    }

    // Função de exclusão de jogo
    async function excluirJogo(index, jogoId) {
      if (confirm("Tem certeza que deseja excluir este jogo?")) {
        // Exclui do Firebase
        await deleteDoc(doc(db, "jogos", jogoId));

        // Exclui do array local
        jogos.splice(index, 1);

        // Atualiza o Firebase e localStorage
        salvarJogos();
        renderizarJogos();
      }
    }

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const novoJogo = {
        data: form.data.value,
        local: form.local.value,
        funcao: form.funcao.value,
        valor: parseFloat(form.valor.value),
        quantidade: parseInt(form.quantidade.value),
      };
      jogos.push(novoJogo);
      salvarJogos();
      renderizarJogos();
      form.reset();
    });

    verTodosBtn.addEventListener("click", () => {
      verTodosBtn.classList.add("ocultar");
      renderizarJogos();
    });
  </script>
</body>

</html>
