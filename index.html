<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Controle de Jogos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f4f0;
      padding: 20px;
      margin: 0;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #2e7d32;
    }

    form {
      display: grid;
      gap: 10px;
      max-width: 500px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    input,
    select,
    button {
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    button {
      background-color: #2e7d32;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #27642b;
    }

    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }

    th,
    td {
      padding: 8px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }

    .valor-extra {
      max-width: 500px;
      margin: 10px auto;
      padding: 10px;
      background: #e0f2f1;
      border: 1px solid #b2dfdb;
      border-radius: 10px;
    }

    .ocultar {
      display: none;
    }

    @media (max-width: 600px) {
      form,
      .valor-extra,
      table {
        font-size: 14px;
      }

      th,
      td {
        padding: 6px;
      }
    }
  </style>
</head>
<body>

  <h1>Controle de Jogos</h1>

  <form id="form-jogo">
    <input type="date" id="data" required />
    <input type="text" id="local" placeholder="Local do jogo" required />
    <select id="funcao" required>
      <option value="">Selecione a função</option>
      <option value="Árbitro">Árbitro</option>
      <option value="Bandeirinha">Bandeirinha</option>
    </select>
    <input type="number" id="valor" placeholder="Valor total" required />
    <input type="number" id="quantidade" placeholder="Quantidade de jogos" value="1" required />
    <button type="submit">Adicionar</button>
  </form>

  <div class="valor-extra" id="valor-info" style="display: none;"></div>

  <table id="tabela-jogos">
    <thead>
      <tr>
        <th>Data</th>
        <th>Local</th>
        <th>Função</th>
        <th>Valor</th>
        <th>10%</th>
        <th>Líquido</th>
        <th>Qtd</th>
        <th>Excluir</th>
      </tr>
    </thead>
    <tbody id="lista-jogos"></tbody>
  </table>

  <button id="ver-todos" class="ocultar">Ver todos</button>

  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
  <script>
    // Sua configuração do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyC4cRV_g8XFCk2WHgLD0DBXkyf6Ttv_pm4",
      authDomain: "controle-de-jogos-f8ccd.firebaseapp.com",
      projectId: "controle-de-jogos-f8ccd",
      storageBucket: "controle-de-jogos-f8ccd.firebasestorage.app",
      messagingSenderId: "266691697880",
      appId: "1:266691697880:web:d1fa596bbd61e4f08e0bad"
    };

    // Inicializa o Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const form = document.getElementById("form-jogo");
    const lista = document.getElementById("lista-jogos");
    const verTodosBtn = document.getElementById("ver-todos");
    const valorInfo = document.getElementById("valor-info");

    let jogos = [];

    // Função para salvar jogos no Firebase
    function salvarJogos() {
      // Salva no Firebase
      jogos.forEach((jogo) => {
        db.collection("jogos").doc(jogo.data + jogo.local + jogo.funcao).set(jogo)
          .then(() => console.log("Jogo salvo no Firebase"))
          .catch((error) => console.error("Erro ao salvar jogo no Firebase: ", error));
      });
    }

    // Função para carregar os jogos do Firebase
    function carregarJogosDoFirebase() {
      db.collection("jogos").get().then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
          const jogo = doc.data();
          jogos.push(jogo);
        });
        renderizarJogos();
      }).catch((error) => {
        console.error("Erro ao carregar jogos do Firebase: ", error);
      });
    }

    // Função para excluir um jogo
    function excluirJogo(index) {
      if (confirm("Tem certeza que deseja excluir este jogo?")) {
        const jogo = jogos[index];
        // Remover do Firebase
        db.collection("jogos").doc(jogo.data + jogo.local + jogo.funcao).delete()
          .then(() => {
            jogos.splice(index, 1);
            salvarJogos(); // Atualiza o Firebase após a exclusão
            renderizarJogos();
          })
          .catch((error) => console.error("Erro ao excluir jogo do Firebase: ", error));
      }
    }

    // Função para calcular valores
    function calcularValores(valor) {
      const dezPorCento = valor * 0.1;
      const liquido = valor - dezPorCento;
      return { dezPorCento, liquido };
    }

    // Função para renderizar jogos
    function renderizarJogos() {
      lista.innerHTML = "";
      const jogosExibidos = window.innerWidth < 600 ? jogos.slice(-3) : jogos;
      jogosExibidos.forEach((jogo, index) => {
        const tr = document.createElement("tr");
        const { dezPorCento, liquido } = calcularValores(jogo.valor);
        tr.innerHTML = `
          <td>${jogo.data}</td>
          <td>${jogo.local}</td>
          <td>${jogo.funcao}</td>
          <td>R$ ${jogo.valor.toFixed(2)}</td>
          <td>R$ ${dezPorCento.toFixed(2)}</td>
          <td>R$ ${liquido.toFixed(2)}</td>
          <td>${jogo.quantidade}</td>
          <td><button onclick="excluirJogo(${index})">X</button></td>
        `;
        lista.appendChild(tr);
      });

      if (jogos.length > 3 && window.innerWidth < 600) {
        verTodosBtn.classList.remove("ocultar");
      } else {
        verTodosBtn.classList.add("ocultar");
      }

      const total = jogos.reduce((soma, j) => soma + j.valor, 0);
      const { dezPorCento, liquido } = calcularValores(total);
      valorInfo.innerHTML = `
        <strong>Total:</strong> R$ ${total.toFixed(2)} |
        <strong>10%:</strong> R$ ${dezPorCento.toFixed(2)} |
        <strong>Líquido:</strong> R$ ${liquido.toFixed(2)}
      `;
      valorInfo.style.display = jogos.length ? "block" : "none";
    }

    // Função para carregar os jogos na inicialização
    function init() {
      carregarJogosDoFirebase();
    }

    // Inicializando
    init();

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const novoJogo = {
        data: form.data.value,
        local: form.local.value,
        funcao: form.funcao.value,
        valor: parseFloat(form.valor.value),
        quantidade: parseInt(form.quantidade.value)
      };
      jogos.push(novoJogo);
      salvarJogos(); // Atualiza o Firebase
      renderizarJogos();
      form.reset();
    });

    verTodosBtn.addEventListener("click", () => {
      verTodosBtn.classList.add("ocultar");
      renderizarJogos();
    });
  </script>

</body>
</html>
